<html><head>
  <meta charset="utf-8">
  <meta name="description" content="Sage-Code EVE control flow statements.">
  <meta name="author" content="Elucian Moise">
  <meta name="keywords" content="sage, code, EVE, language">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Website title -->
  <title>EVE Control</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <!-- Icon -->
  <link rel="icon" type="image/png"  href="../images/favicon.ico">
  <!-- Eve code highlighter -->
  <script src="eve.js"></script>
  <!-- Custom css -->
  <link rel="stylesheet" href="../sage.css">
  </head>
<body onload="eve_render();">

<div class="container">

<!-- header -->
<div class="row">
    <div class="col">
        <a href="https://sagecode.net"><img src="../images/sage-logo.svg" alt="Sage-Code Laboratory" height="80"/></a>
    </div>
    <div class="col  bottom-right">
        <a href="index.html#lang-index">index</a><--
    </div>
</div><hr>

<h1>EVE Control Flow</h1>

<div class="alert alert-secondary shadow-sm">
Most languages have similar flow control statements. These are block statements that can execute or no depending on one or more conditions. A control flow statement can be a decision statement a repetitive statement or a selection statement.</div>

<h2>Bookmarks</h2>

<table class="table table-sm table-bordered">
<tr><th>1</th><th><a href="#if"     >if     </a></th> <td>conditional expression      </td></tr>
<tr><th>2</th><th><a href="#else"   >else   </a></th> <td>decision block              </td></tr>
<tr><th>3</th><th><a href="#ladder"  >ladder  </a></th> <td>conditional selector        </td></tr>
<tr><th>3</th><th><a href="#match"  >match  </a></th> <td>value based selector       </td></tr>
<tr><th>4</th><th><a href="#loop"   >loop   </a></th> <td>unconditional repetition    </td></tr>
<tr><th>5</th><th><a href="#while"  >while  </a></th> <td>conditional repetition      </td></tr>
<tr><th>6</th><th><a href="#for"    >for    </a></th> <td>range controlled repetition </td></tr>
<tr><th>7</th><th><a href="#try">try</a></th> <td>error protected block</td></tr>
</table>

<h2><a id="if"></a>Conditional</h2>

<p>Keyword "if" establish a conditional statement. Also it can be used in expressions. A conditional statement can be a simple statement or a block statement. You can use "if" after a simple statement or before a block statement.</p>

<h4>Code pattern</h4>

<p>This is syntax for a simple statement with conditional execution. It enable or prevent a statement to be executed. It can not be used for block statements.</p>

<pre><code class="language-eve"># conditioned statement
statement if boolean_variable;
statement if boolean_expression;
</code></pre>

<h4>Example</h4>

<p>Next examples show how we can use conditional to print something when expression is fulfilled.</p>

<pre><code class="language-eve"># conditional print
print "a is even" if (a % 2  = 0);
print "a is odd"  if (a % 2 != 0);
</code></pre>

<h2><a id="else"></a>Decision block</h2>

<p>In next pattern we use "if/else" keywords to create a decision fork.</p>

<div align="center">
  <img src="../images/decision.jpg" alt="decision" srcset="../images/decision.svg"
  width="520" class="img-fluid protect rounded shadow border" >
  <p>decision diagram</p>
</div>

<pre><code class="language-eve"># dual path decision
if expression then
  ** true branch
  ...
else
  ** false branch
  ...
done;
</code></pre>

<h4>Notes:</h4>
<ol>
    <li>The else branch is optional;</li>
    <li>This block is do not use label;</li>
    <li>This block do not have local scope;</li>
</ol>

<h2><a id="ladder"></a>Ladder</h2>

<p>A ladder is a conditional multi-path selector based on exclusive conditions. Only one branch is executed. If no condition is satisfied the alternative branch is executed. Alternative branch is optional.</p>

<div align="center">
  <img src="../images/ladder.jpg" alt="decision" srcset="../images/ladder.svg"
  width="640" class="img-fluid protect rounded shadow border" >
  <p>decision ladder</p>
</div>

<h4>Example:</h4>

<pre><code class="language-eve">#selection ladder
if condition_1 then
    ** first branch
    ...
else if condition_2 then
    ** second branch
    ...
else if condition_3 then
    ** third branch
    ...
else
    ** alternative branch
    ...
done;
</code></pre>

<p><b>Notes:&nbsp;</b>Previous pattern show a complex situation having several conditions in cascade. Cases should be exclusive and most probable case should be evaluated first.</p>

<h2><a id="match"></a>Match Selector</h2>

<p>
This is a multi-path selector similar to switch also named: jump table. It two variants: "all" or "one". That is optional keyword. If used, ALL will evaluate all "when" values it may be matching multiple when blocks. If "one" is used (this is the default), only first block that has a matching value will be executed and the rest are ignored even if a second match exist. The second match should not be present though and is probably a mistake!
</p>

<div align="center">
    <img src="img/eve-match.svg" alt="match"
    width="320" class="img-fluid protect rounded shadow border" >
    <p>Match Diagram</p>
  </div>

  <h4>Pattern:</h4>

<pre><code class="language-eve">
# Define a selector variable
new s := {v1,v2,v3,v4};

** create match selector
match s [all | one]:
    ** declare locals
    ...
when v1 then
    ** first path
    ...
    [break];
when v1, v2 then
    ** second path
    ...
other
    ** v3 or v4 found
    ...
done;
</code></pre>

<h4>Note:</h4>
<ul>
<li>Last when other is optional when the selector is not fully cover by all the cases;</li>
<li>break is optional and is used only with "all" selection. "one" selection is default;</li>
</ul>

<h2><a id="loop"></a>Unconditional Loop</h2>

<p>This is a repetitive block statement. The loop is executed until a "break" statement is encounter. The break can be conditioned by "if". This is called an "interruption". You can use keyword "repeat"with conditional "if" to restart the loop early and skip several statements. This is called a "shortcut".</p>

<div align="center">
  <img src="img/loop.svg" alt="loop"
  width="580" class="img-fluid protect rounded shadow border" >
  <p>infinite loop </p>
</div>

<h4>Syntax:</h4>

<pre><code class="language-eve">#infinite loop
cycle [label:]
    ** declare control variable
loop
    ** loop shortcut
    skip [label] if condition ;
    ...
    ** early interruption
    exit [label] if condition;
    ...
repeat [label] [if condition];
</code></pre>

<h4>Notes:</h4>

<ul>
<li>Unconditional loop is executed at least one time;</li>
<li>The label is optional, that's why is in square brackets;</li>
<li>The label is used, for nested loops otherwise is not necessary.</li>
</ul>

<h2><a id="while"></a>While Loop</h2>
<p>Execute a block of code as long as one condition is true. When the condition become false the repetitive block stops and block "else" is executed. If the condition is never true only the "else" block is executed.</p>

<div align="center">
  <img src="../images/while.svg" alt="while-loop"
  width="520" class="img-fluid protect rounded shadow border" >
  <p>while loop</p>
</div>

<h4>Syntax:</h4>
<pre><code class="language-eve">#conditional loop
cycle [label]:
    ** declare control variables
while condition loop
    ** shortcut iteration
    skip if condition;
    ...
    ** early interruption
    exit if condition;
    ...
then
    ** alternative path
    ...
repeat [label] if condition;
</code></pre>

<h4>Example:</h4>

<pre><code class="language-eve">
/** This driver demonstrate
    how to visit members of a List */
driver while_demo:
**  create a shared list
    set this := ("a","b","c","d","e");
process main:
    ** start unlabeled cycle
    cycle: 
        ** volatile variables
        new i := 0 : Integer; 
        new e : Symbol;       
    while i &lt; this.length() loop
        let e := this[i];
        let i += 1;
        if e  &gt;= "c" then
            write e;
            write ',' if e is not this.tail;
        done;
    then
        write 'i = ' + i;
    repeat; 
    ** flush the write buffer
    print; -- "a","b","c","d","e"
return;
</code></pre>

<h4>Output:</h4>
<pre class="output">
"c","d","e"
i = 5
</pre>


<h2><a id="for"></a>For Loop</h2>
<p>This statement use one control variables to visit elements in a collection or domain. First use-case of this is to iterate over a range of numbers. In EVE the range is represented as (min..nax).</p>

<div align="center">
  <img src="img/for-loop.svg" alt="for-loop"
  width="580" class="img-fluid protect rounded shadow border" >
  <p>for ... loop</p>
</div>

<h4>Pattern:</h4>

<pre><code class="language-eve">#for loop syntax
cycle [label]:
    new var := 0;
for var in (min..max) loop
    ** block statements;
    ...
    ** next iteration
    next if condition;
    ...
    ** early interruption
    exit if condition;
    ...
repeat [label];
</code></pre>

<h4>Notes:</h4>
<ul>
<li>Control variable is auto-incremented at end of loop;</li>
<li>Control variable must be declared in local scope;</li>
<li>Control variable is not available after the loop;</li>
</ul>

<p>Example of range iteration using step ratio 2:</p>
<pre><code class="language-eve">#example of range iteration
cycle: 
    new i :Integer;
for i in (1..10:2) loop
    ** write only odd numbers
    write i;
    write ',' if (i &lt; 9);
repeat;

print;
</code></pre>

<h4>Output:</h4>

<pre class="output">
1,3,5,7,9
</pre>

<h2><a id="try"></a>try</h2>

<p>A try block is useful to handle recoverable errors. You can use try in functions or processes. A try block can improve code readability and avoid catastrofic defects in your final product.</p>

<div align="center">
  <img src="img/eve-try.svg" alt="try blocks"
  width="500" class="img-fluid protect rounded shadow border" >
  <p>job ... try</p>
</div>

<h4>Syntax Pattern</h4>

<p>A try has several executable blocks, one error handler block and a finalization block. The finalization block is executed even if there is an error.</p>

<pre><code class="language-eve">
[process | function] name(params):
  ** declare locals
  ....
  [job (code:"description")] try
      ** protected block
      ...
      raise (code,"message");
      ...
      expect (condition) [else "message"];
      ...
  [job (code:"description")] try
      ...
recover
  case $error.code == 100 then
    ** handler 1
    ...
  case $error.code == 100 then
    ** handler 2
    ...
  else 
    ** default 
    ...
finalize
   ** close resources
   ...
return;
</code></pre>

<p><b>Note: </b>A process or function can to one or more jobs. Each job is a try block. The recover and finalization regions are colapsed into one. Details about using a try block will be explained later.</p>

<hr>
<p><b>Read next:</b>
<a href="classes.html">Classes</a></p>

<!-- Footer -->
<footer class="footer">
  <div class="footer-copyright text-center"></div>
</footer>
</div>
</body>
</html>