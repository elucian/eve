<html><head>
  <meta charset="utf-8">
  <meta name="description" content="Sage-Code EVE control flow statements.">
  <meta name="author" content="Elucian Moise">
  <meta name="keywords" content="sage, code, EVE, language">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Website title -->
  <title>EVE Control</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <!-- Icon -->
  <link rel="icon" type="image/png"  href="../images/favicon.ico">
  <!-- Eve code highlighter -->
  <script src="eve.js"></script>
  <!-- Custom css -->
  <link rel="stylesheet" href="../sage.css">
  </head>
<body onload="eve_render();">

<div class="container">

<!-- header -->
<div class="row">
    <div class="col">
        <a href="https://sagecode.net"><img src="../images/sage-logo.svg" alt="Sage-Code Laboratory" height="80"/></a>
    </div>
    <div class="col  bottom-right">
        <a href="index.html#lang-index">index</a><--
    </div>
</div><hr>

<h1>EVE Control Flow</h1>

<div class="alert alert-secondary shadow-sm">
Most languages have similar flow control statements. These are block statements that can execute or no depending on one or more conditions. A control flow statement can be a decision statement a repetitive statement or a selection statement.</div>

<h2>Bookmarks</h2>

<table class="table table-sm table-bordered">
<tr><th>1</th><th><a href="#if"     >if     </a></th> <td>conditional expression      </td></tr>
<tr><th>2</th><th><a href="#else"   >else   </a></th> <td>decision block              </td></tr>
<tr><th>3</th><th><a href="#trial"  >trial  </a></th> <td>conditional selector        </td></tr>
<tr><th>4</th><th><a href="#loop"   >loop   </a></th> <td>unconditional repetition    </td></tr>
<tr><th>5</th><th><a href="#while"  >while  </a></th> <td>conditional repetition      </td></tr>
<tr><th>6</th><th><a href="#for"    >for    </a></th> <td>range controlled repetition </td></tr>
<tr><th>7</th><th><a href="#process">process</a></th> <td>local processing block      </td></tr>
</table>

<h2><a id="if"></a>Conditional</h2>

<p>Keyword "if" establish a conditional statement. Also it can be used in expressions. A conditional statement can be a simple statement or a block statement. You can use "if" after a simple statement or before a block statement.</p>

<h4>Pattern 1:</h4>

<p>This is syntax for a simple statement with conditional execution. It enable or prevent a statement to be executed. It can not be used for block statements.</p>

<pre><code class="language-eve"># conditioned statement
statement if boolean_variable;
statement if boolean_expression;
</code></pre>

<p>Next examples show how we can use conditional to print something when expression is fulfilled.</p>

<pre><code class="language-eve"># conditional print
print "a is even" if (a % 2  = 0);
print "a is odd"  if (a % 2 != 0);
</code></pre>

<h4>Pattern 2</h4>

<p>In other languages we use ternary operator "?" but in EVE we can use "if" and "else" keywords to create complex conditional expressions like these below:</p>

<pre><code class="language-eve">#conditional expressions
v := value1 if condition1 else value2;
v := value1 if condition1 else
     value2 if condition2 else
     value3;
</code></pre>

<h2><a id="else"></a>Decision block</h2>

<p>In next pattern we use "if/else" keywords to create a decision fork.</p>

<div align="center">
  <img src="../images/decision.jpg" alt="decision" srcset="../images/decision.svg"
  width="520" class="img-fluid protect rounded shadow border" >
  <p>decision diagram</p>
</div>

<pre><code class="language-eve"># dual path decision
if expression then
  ** true branch
  ...
else
  ** false branch
  ...
end if;
</code></pre>

<h4>Notes:<h4>
<ol>
    <li>The else branch is optional;</li>
    <li>This block is do not use label;</li>
    <li>This block do not have local scope;</li>
</ol>

<h2><a id="trial"></a>Trial</h2>

<p>By using keywords "trial" and "case" you can create a cascade of decisions. This is a block statement called <em>Selection Ladder</em>. It has several conditional branches plus one optional branch that is executed when no other condition is fulfilled.</p>

<div align="center">
  <img src="../images/ladder.jpg" alt="decision" srcset="../images/ladder.svg"
  width="640" class="img-fluid protect rounded shadow border" >
  <p>decision ladder</p>
</div>

<h4>Example:</h4>

<pre><code class="language-eve">#selection ladder
trial [label]:
    ** local variables
    ...
case condition_1 then
    ** first branch
    ...
case condition_2 then
    ** second branch
        ...
case condition_3 then
    ** second branch
        ...
miss
    ** third branch
        ...
end trial [label];
</code></pre>

<p><b>Notes:&nbsp;</b>Previous pattern show a complex situation having several conditions in cascade. Cases should be exclusive. Most probable case should be evaluated first. If any of the cases is valid the other cases are not evaluated. Usually the cases are aligned with the trial keyword.</p>

<h2><a id="match"></a>Match Selector</h2>

<p>
This is a multi-path selector similar also named: jump table. A jump table in Bee has two variants: "all" or "one". That is optional keyword. If used, ALL will evaluate all "when" values it may be matching multiple when blocks. If "one" is used (this is the default), only first block that has a matching value will be executed and the rest are ignored even if a second match exist. The second match should not be present though and is probably a mistake!
</p>

<div align="center">
    <img src="img/eve-match.svg" alt="match"
    width="320" class="img-fluid protect rounded shadow border" >
    <p>Match Diagram</p>
  </div>

  <h4>Pattern:</h4>

<pre><code class="language-eve"># Using match selector
type
    Selector(0) = {v1,v2,v3,v4} <: Ordinal;
local
    select := Selector.random();
process
    match select:
        ** declare locals
        ...
    when v1 then
        ** first path
        ...
    when v1, v2 then
        ** second path
        ...
    [when other]
        ** v3 or v4 found
        ...
    end match [select];
return;
</code></pre>

<h4>Note:</h4>
<p>Last when other is optional when the selector is not fully cover by all the cases;</p>

<h2><a id="loop"></a>Unconditional Loop</h2>

<p>This is a repetitive block statement. The loop is executed until a "break" statement is encounter. The break can be conditioned by "if". This is called an "interruption". You can use keyword "repeat"with conditional "if" to restart the loop early and skip several statements. This is called a "shortcut".</p>

<div align="center">
  <img src="img/loop.svg" alt="loop"
  width="580" class="img-fluid protect rounded shadow border" >
  <p>infinite loop </p>
</div>

<h4>Syntax:</h4>

<pre><code class="language-eve">#infinite loop
cycle [label:]
    ** declare control variable
loop
    ** shortcut iteration
    repeat [label] if condition ;
    ...
    ** early interruption
    break [label] if condition;
    ...
end cycle [label];
</code></pre>

<h4>Notes:</h4>

<li>Unconditional loop is executed at least one time;</li>
<li>Repeat is equivalent to "continue" statement in other languages;</li>
<li>The label is optional, that's why is in square brackets;</li>
<li>The label is used, for nested loops otherwise is not necessary.</li>

<h2><a id="while"></a>While Loop</h2>
<p>Execute a block of code as long as one condition is true. When the condition become false the repetitive block stops and block "else" is executed. If the condition is never true only the "else" block is executed.</p>

<div align="center">
  <img src="../images/while.svg" alt="while-loop"
  width="520" class="img-fluid protect rounded shadow border" >
  <p>while loop</p>
</div>

<h4>Syntax:</h4>
<pre><code class="language-eve">#conditional loop
cycle [label]:
    ** declare control variables
while condition loop
    ** shortcut iteration
    repeat if condition;
    ...
    ** early interruption
    break if condition;
    ...
then
    ** alternative path
    ...
end cycle;
</code></pre>

<h4>Example:</h4>

<pre><code class="language-eve">** example of collection iteration
driver while_demo:
/** This driver demonstrate
    how to visit members of a List */
local
    List this := ["a","b","c","d","e"];
process
    cycle:
        Integer i := 0; // private
        Symbol  e;      // private
    while i &lt; this.length() loop
        alter e := this[i];
        alter i += 1;
        case: when e  &gt;= "c" then
            write e;
            write ',' if e is not this.tail;
        end case;
    then
        write ('i = ' + i);
    end cycle;
    print;
return;
</code></pre>

<h4>Output:</h4>
<pre class="output">
"c","d","e"
i = 5
</pre>


<h2><a id="for"></a>For Loop</h2>
<p>This statement use one control variables to visit elements in a collection or domain. First use-case of this is to iterate over a range of numbers. In EVE the range is represented as (min..nax).</p>

<div align="center">
  <img src="img/for-loop.svg" alt="for-loop"
  width="580" class="img-fluid protect rounded shadow border" >
  <p>for ... loop</p>
</div>

<h4>Pattern:</h4>

<pre><code class="language-eve">#for loop syntax
cycle [label]:
    Integer var := 0;
for var in (min..max) loop
    ** block statements;
    ...
    ** next iteration
    next if condition;
    ...
    ** early interruption
    break if condition;
    ...
end cycle [label];
</code></pre>

<h4>Notes:</h4>
<ul>
<li>Control variable is auto-incremented at end of loop;</li>
<li>Control variable must be declared in local scope;</li>
<li>Control variable is not available after the loop;</li>
</ul>

<p>Example of range iteration using step ratio 2:</p>
<pre><code class="language-eve">#example of range iteration
cycle: for i in (1..10:2) loop
    ** write only odd numbers
    write i;
    write ',' if (i &lt; 9);
end cycle;
print;
</code></pre>

<h4>Output:</h4>

<pre class="output">
1,3,5,7,9
</pre>

<h2><a id="process"/>Process</h2>

<p>A process is a series of tasks. Each task can resolve one small use-case. Tasks are executed in serial mode. Any task can fail. When a task fails the process is interrupted an the recover section is executed. If there is no recover section the error is propagated to parent process or to operating system.</p>

<h4>Pattern:</h4>

<pre><code class="language-eve"># define process with tasks
local
    ** local declarations
    ....
process
    ** preconditions
    exit if condition;
    ....
    ** open resources
    ...
task c1:"description" try
    ...
    skip if condition;
task c2:"description" try
    ...
    over if condition;
task c3:"description" try
    ...
    pass if condition;
task c4:"description" try
    ...
    fail if condition;
recover
    ** exception region
    ...
    retry if condition;
    ...
    raise if condition;
release
    ** close resources
    ...
report
    ** report the errors
    ...
return;
</code></pre>

<h3>Process Keywords</h3>

<p>The process is created and controlled by many new keywords. Mastering these keywords is important to handle possible errors and avoid catastrophic defects. Most of keywords are intuitive presented in the design pattern above.</p>

<table class="table table-sm table-bordered">
<tr><th>process</th><td>create one process (driver/aspect/routine)    </td></tr>
<tr><th>task   </th><td>create one step in the process                </td></tr>
<tr><th>try    </th><td>begin task executable region                  </td></tr>
<tr><th>pass   </th><td>end current task with result "pass"           </td></tr>
<tr><th>fail   </th><td>end current task with result "fail"           </td></tr>
<tr><th>skip   </th><td>continue to specified next task               </td></tr>
<tr><th>retry  </th><td>redo the task that raise a recoverable error  </td></tr>
<tr><th>abort  </th><td>ignore all next tasks and execute the release </td></tr>
<tr><th>raise  </th><td>issued from recover, propagate the error      </td></tr>
</table>

<h4>Execution Notes</h4>

<ul>
<li>Any driver, aspect or routine can be implement as a process.</li>
<li>All tasks of a single process are execute sequential from top down.</li>
<li>When the last task is finished the process is ending.</li>
</ul>

<h4>Process Interruption</h4>

<p>Interruption keywords (exit, halt, over) can be used to interrupt a process but is not the normal way to terminate a process. These keywords are used for processes that are not divided into tasks. Using these keywords, a process is interrupted but the finalization regions are not executed.</p>

<hr>
<p><b>Read next:</b>
<a href="classes.html">Classes</a></p>

<!-- Footer -->
<footer class="footer">
  <div class="footer-copyright text-center"></div>
</footer>
</div>
</body>
</html>